target_default: 6_drivers_fetch

packages:
  - sp
  - scipiper
  - dplyr
  - ncdf4
  - sf
  - stringr

sources:
  - 6_drivers/src/nldas_cube_utils.R
  - 6_drivers/src/grid_utils.R

targets:
  6_drivers_fetch:
    depends:
      - "6_drivers/log/nc/6_fetch_new_cubes_tasks.ind"

  replete_time_range:
    command: c(t0=I(0), t1 = I(24999)) # for doing one timechunk: 24999

  nccopy_time_stride:
    command: c(I(25000))

  cube_data_dir:
    command: c(I("6_drivers/out/nc"))

  cube_ind_dir:
    command: c(I("6_drivers/log/nc"))


  nldas_empty_box: # this is the domain that will require a FULL data pull in the time dimension
    command: readRDS('6_drivers/in/nldas_cells.rds')

  nldas_new_cube_files:
    command: calc_nldas_files(nldas_empty_box, replete_time_range, nccopy_time_stride, nc_dir = cube_data_dir)

  nldas_new_cube_plan:
    command: create_cube_task_plan(nldas_new_cube_files, max_steps = I(100), skip_on_exists = TRUE)

  "6_fetch_new_cubes_tasks.yml":
    command: create_cube_task_makefile(target_name, nldas_new_cube_plan)

  "6_drivers/log/6_fetch_new_cubes_tasks.ind":
    command: loop_tasks(
      task_plan = nldas_new_cube_plan,
      task_makefile = "6_fetch_new_cubes_tasks.yml")
